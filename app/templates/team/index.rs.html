@use super::super::layout_html;
@use super::create_invite_html;
@use super::delete_html;
@use crate::layout::SideBar;
@use crate::cornucopia::queries::organisations::GetUsers;
@use crate::cornucopia::queries::organisations::Organisation;
@use crate::cornucopia::queries::invitations::GetAll;
@use crate::templates::statics::delete_svg;

@(title: &str, users: Vec<GetUsers>, invites: Vec<GetAll>, organisation: &Organisation)

@:layout_html(title, {

    @for user in &users {
        @:delete_html(user.organisation_id, user.id, &user.email, &organisation.id)
    }

    <div class="m_card">
        <div class="header">
            <span>Team</span>
        </div>
        <div class="body">
            <table class="m_table team_table">
                <thead>
                    <tr>
                        <th>Email</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    @for user in users {
                        <tr>
                            <td>
                                @user.email
                            </td>
                            @if user.is_admin {
                                <td><span class="a_badge a_badge--success">Administrator</span></td>
                            } else {
                                <td><span class="a_badge a_badge--success">Invitation Accepted</span></td>
                            }
                            <td>
                                <a href="#" data-drawer-target='@format!("delete-member-drawer-{}-{}", user.organisation_id, user.id)'>
                                    <img src="/static/@delete_svg.name" width="18"></img>
                                </a>
                            </td>
                        </tr>
                    }

                    @for invite in invites {
                        <tr>
                            <td>
                                @invite.email
                            </td>
                            <td>Invitation Pending</td>
                            <td>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
}, {
    @:create_invite_html(&organisation.id)
    <button class="a_button mini primary" id="invite-user">New User</button>
}, organisation, None, SideBar::Team)
